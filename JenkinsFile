pipeline {
  agent any

  environment {
    FRONTEND_DIR = 'frontend'
    BACKEND_DIR = 'backend'
  }

  stages {
    stage('ğŸ“¥ Checkout') {
      steps {
        echo 'Cloning repository...'
        checkout scm
      }
    }

    stage('ğŸ“¦ Install Frontend Dependencies') {
      steps {
        dir("${FRONTEND_DIR}") {
          echo 'Installing frontend dependencies...'
          bat 'npm install'
        }
      }
    }

    stage('ğŸ“¦ Install Backend Dependencies') {
      steps {
        dir("${BACKEND_DIR}") {
          echo 'Installing backend dependencies...'
          bat 'npm install'
        }
      }
    }

    stage('ğŸ§ª Run Frontend Tests') {
      steps {
        dir("${FRONTEND_DIR}") {
          echo 'Running frontend tests with Vitest...'
          bat 'npm run test || exit 0'
        }
      }
    }

    stage('ğŸ§ª Run Backend Tests') {
      steps {
        dir("${BACKEND_DIR}") {
          echo 'Running backend tests...'
          bat 'npm run test || exit 0'
        }
      }
    }

    stage('ğŸ—ï¸ Build Frontend') {
      steps {
        dir("${FRONTEND_DIR}") {
          echo 'Building Vite app...'
          bat 'npm run build'
        }
      }
    }

    stage('ğŸ“¦ Archive Frontend Build') {
      steps {
        archiveArtifacts artifacts: "${FRONTEND_DIR}/dist/**", fingerprint: true
      }
    }
  }

  post {
    success {
      echo 'âœ… Build completed successfully!'
    }
    failure {
      echo 'âŒ Build failed. Please check the logs.'
    }
  }
}
